<div class="version-comparison">
  <div class="header">
    <h2>üöÄ SignalTree Version Comparison</h2>
    <p class="subtitle">
      Compare basic vs optimized SignalTree performance across different
      scenarios
    </p>
  </div>

  <div class="test-controls">
    <div class="control-group">
      <label for="test-type">Test Type:</label>
      <select id="test-type" [(ngModel)]="currentTest" class="form-control">
        <option value="nested-updates">Nested Updates</option>
        <option value="pattern-invalidation">Pattern Invalidation</option>
        <option value="memory-optimization">Memory Optimization</option>
        <option value="memoization">Memoization</option>
        <option value="debug-mode">Debug Mode</option>
      </select>
    </div>

    <div class="control-group">
      <label for="test-size">Test Size:</label>
      <input
        id="test-size"
        type="number"
        [(ngModel)]="testSize"
        min="10"
        max="10000"
        step="10"
        class="form-control"
      />
    </div>

    <div class="control-group">
      <button
        (click)="runCurrentTest()"
        [disabled]="isRunning()"
        class="btn btn-primary"
      >
        {{ isRunning() ? 'Running...' : 'Run Test' }}
      </button>

      <button
        (click)="runAllTests()"
        [disabled]="isRunning()"
        class="btn btn-secondary"
      >
        {{ isRunning() ? 'Running All...' : 'Run All Tests' }}
      </button>
    </div>
  </div>

  <div class="test-description">
    <h3>{{ currentTest() | titlecase | replace : '-' : ' ' }}</h3>
    <p>{{ getTestDescription(currentTest()) }}</p>
  </div>

  @if (isRunning()) {
  <div class="running-indicator">
    <div class="spinner"></div>
    <span
      >Running
      {{ currentTest() | titlecase | replace : '-' : ' ' }} test...</span
    >
  </div>
  }

  <div class="results-container">
    <div class="results-grid">
      <!-- Legacy Version Results -->
      <div class="result-card basic">
        <h3>üìä Legacy Version</h3>
        <div class="metrics">
          <div class="metric">
            <span class="label">Updates:</span>
            <span class="value">{{
              testResults().legacy.updates | number
            }}</span>
          </div>
          <div class="metric">
            <span class="label">Total Time:</span>
            <span class="value">{{
              formatTime(testResults().legacy.totalTime)
            }}</span>
          </div>
          <div class="metric">
            <span class="label">Average Time:</span>
            <span class="value">{{
              formatTime(testResults().legacy.averageTime)
            }}</span>
          </div>
          <div class="metric">
            <span class="label">Memory Usage:</span>
            <span class="value">{{
              formatMemory(testResults().legacy.memoryUsage)
            }}</span>
          </div>
          <div class="metric">
            <span class="label">Effect Runs:</span>
            <span class="value">{{
              testResults().legacy.renderCount | number
            }}</span>
          </div>
        </div>
      </div>

      <!-- Optimized Version Results -->
      <div class="result-card optimized">
        <h3>‚ö° Optimized Version</h3>
        <div class="metrics">
          <div class="metric">
            <span class="label">Updates:</span>
            <span class="value">{{
              testResults().optimized.updates | number
            }}</span>
          </div>
          <div class="metric">
            <span class="label">Total Time:</span>
            <span class="value">{{
              formatTime(testResults().optimized.totalTime)
            }}</span>
          </div>
          <div class="metric">
            <span class="label">Average Time:</span>
            <span class="value">{{
              formatTime(testResults().optimized.averageTime)
            }}</span>
          </div>
          <div class="metric">
            <span class="label">Memory Usage:</span>
            <span class="value">{{
              formatMemory(testResults().optimized.memoryUsage)
            }}</span>
          </div>
          <div class="metric">
            <span class="label">Effect Runs:</span>
            <span class="value">{{
              testResults().optimized.renderCount | number
            }}</span>
          </div>
          @if (testResults().optimized.cacheHits > 0) {
          <div class="metric">
            <span class="label">Cache Hits:</span>
            <span class="value">{{
              testResults().optimized.cacheHits | number
            }}</span>
          </div>
          }
        </div>
      </div>

      <!-- Improvement Summary -->
      <div class="result-card improvement">
        <h3>üìà Improvements</h3>
        <div class="metrics">
          <div class="metric improvement-metric">
            <span class="label">Performance:</span>
            <span class="value positive"
              >+{{
                formatPercentage(testResults().improvement.performance)
              }}</span
            >
          </div>
          <div class="metric improvement-metric">
            <span class="label">Memory:</span>
            <span class="value positive"
              >+{{ formatPercentage(testResults().improvement.memory) }}</span
            >
          </div>
          <div class="metric improvement-metric">
            <span class="label">Efficiency:</span>
            <span class="value positive"
              >+{{
                formatPercentage(testResults().improvement.efficiency)
              }}</span
            >
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Code Comparison -->
  <div class="code-comparison">
    <h3>üìù Code Comparison</h3>
    <div class="code-grid">
      <div class="code-block">
        <h4>Basic Version</h4>
        <pre><code>{{ getLegacyTreeCode() }}</code></pre>
      </div>
      <div class="code-block">
        <h4>Optimized Version</h4>
        <pre><code>{{ getOptimizedTreeCode() }}</code></pre>
      </div>
    </div>
  </div>

  <!-- Live Data Visualization -->
  <div class="live-data">
    <h3>üîÑ Live Data</h3>
    <div class="data-grid">
      <div class="data-section">
        <h4>Basic Tree State</h4>
        <div class="state-preview">
          <div class="state-item">
            <span class="key">Active Users:</span>
            <span class="value">{{ legacyActiveUsers().length }}</span>
          </div>
          <div class="state-item">
            <span class="key">Total Products:</span>
            <span class="value">{{ legacyTree.$.products().length }}</span>
          </div>
          <div class="state-item">
            <span class="key">Theme:</span>
            <span class="value">{{ legacyTree.$.settings.theme() }}</span>
          </div>
          <div class="state-item">
            <span class="key">Expensive Computation:</span>
            <span class="value">{{
              legacyExpensiveComputation() | number : '1.0-0'
            }}</span>
          </div>
        </div>
      </div>

      <div class="data-section">
        <h4>Optimized Tree State</h4>
        <div class="state-preview">
          <div class="state-item">
            <span class="key">Active Users:</span>
            <span class="value">{{ optimizedActiveUsers().length }}</span>
          </div>
          <div class="state-item">
            <span class="key">Total Products:</span>
            <span class="value">{{ optimizedTree.$.products().length }}</span>
          </div>
          <div class="state-item">
            <span class="key">Theme:</span>
            <span class="value">{{ optimizedTree.$.settings.theme() }}</span>
          </div>
          <div class="state-item">
            <span class="key">Expensive Computation:</span>
            <span class="value">{{
              optimizedExpensiveComputation() | number : '1.0-0'
            }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Feature Matrix -->
  <div class="feature-matrix">
    <h3>üéØ Feature Matrix</h3>
    <table class="features-table">
      <thead>
        <tr>
          <th>Feature</th>
          <th>Basic</th>
          <th>Optimized</th>
          <th>Benefit</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Batch Updates</td>
          <td class="unavailable">‚ùå</td>
          <td class="available">‚úÖ</td>
          <td>Reduces effect runs by ~70%</td>
        </tr>
        <tr>
          <td>Memoization</td>
          <td class="unavailable">‚ùå</td>
          <td class="available">‚úÖ</td>
          <td>Caches expensive computations</td>
        </tr>
        <tr>
          <td>Pattern Invalidation</td>
          <td class="unavailable">‚ùå</td>
          <td class="available">‚úÖ</td>
          <td>Smart cache cleanup</td>
        </tr>
        <tr>
          <td>Debug Mode</td>
          <td class="unavailable">‚ùå</td>
          <td class="available">‚úÖ</td>
          <td>Development insights</td>
        </tr>
        <tr>
          <td>Memory Optimization</td>
          <td class="unavailable">‚ùå</td>
          <td class="available">‚úÖ</td>
          <td>Automatic cleanup</td>
        </tr>
        <tr>
          <td>Enhanced Destroy</td>
          <td class="unavailable">‚ùå</td>
          <td class="available">‚úÖ</td>
          <td>Complete cleanup</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Performance Tips -->
  <div class="performance-tips">
    <h3>üí° Performance Tips</h3>
    <div class="tips-grid">
      <div class="tip-card">
        <h4>üî• When to Use Optimizations</h4>
        <ul>
          <li>High-frequency updates (>100/sec)</li>
          <li>Complex nested state structures</li>
          <li>Large datasets (>1000 items)</li>
          <li>Expensive computed values</li>
        </ul>
      </div>
      <div class="tip-card">
        <h4>üéØ Best Practices</h4>
        <ul>
          <li>Start basic, optimize as needed</li>
          <li>Use batchUpdate for multiple changes</li>
          <li>Enable memoization for computations</li>
          <li>Use pattern invalidation wisely</li>
        </ul>
      </div>
      <div class="tip-card">
        <h4>üîß Debug Mode Benefits</h4>
        <ul>
          <li>Track update patterns</li>
          <li>Identify performance bottlenecks</li>
          <li>Monitor cache usage</li>
          <li>Validate optimization effects</li>
        </ul>
      </div>
    </div>
  </div>
</div>
