<div class="container mx-auto p-6">
  <h1 class="text-3xl font-bold text-gray-800 mb-6">üìù Form Validation Demo</h1>

  <div class="mb-6 bg-orange-50 border border-orange-200 rounded-lg p-4">
    <div class="flex items-center mb-2">
      <span class="text-orange-600 mr-2">üí°</span>
      <h3 class="font-semibold text-orange-800">What This Demonstrates</h3>
    </div>
    <p class="text-orange-700 text-sm">
      Form trees provide comprehensive validation with synchronous and
      asynchronous validators, field-level error handling, and reactive form
      state management.
    </p>
  </div>

  <!-- Form Status Overview -->
  <div class="mb-8 grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="bg-white rounded-lg shadow-md p-4 text-center">
      <div
        class="text-2xl mb-2"
        [class]="formTree.valid() ? 'text-green-600' : 'text-red-600'"
      >
        {{ formTree.valid() ? '‚úÖ' : '‚ùå' }}
      </div>
      <div class="text-sm text-gray-600">Form Valid</div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-4 text-center">
      <div
        class="text-2xl mb-2"
        [class]="formTree.dirty() ? 'text-blue-600' : 'text-gray-400'"
      >
        {{ formTree.dirty() ? 'üìù' : 'üìÑ' }}
      </div>
      <div class="text-sm text-gray-600">
        {{ formTree.dirty() ? 'Modified' : 'Pristine' }}
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-4 text-center">
      <div
        class="text-2xl mb-2"
        [class]="formTree.submitting() ? 'text-yellow-600' : 'text-gray-400'"
      >
        {{ formTree.submitting() ? '‚è≥' : 'üí§' }}
      </div>
      <div class="text-sm text-gray-600">
        {{ formTree.submitting() ? 'Submitting' : 'Ready' }}
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-4 text-center">
      <div class="text-2xl text-purple-600 mb-2">
        {{ getErrorCount() }}
      </div>
      <div class="text-sm text-gray-600">Validation Errors</div>
    </div>
  </div>

  <!-- Registration Form -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-6">
      üë§ User Registration Form
    </h2>

    <form (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- Personal Information -->
      <div class="border-b border-gray-200 pb-6">
        <h3 class="text-lg font-medium text-gray-800 mb-4">
          Personal Information
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label
              for="firstName"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              First Name *
            </label>
            <input
              id="firstName"
              [(ngModel)]="formTree.state.firstName"
              (blur)="markFieldAsTouched('firstName')"
              name="firstName"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
              [class.border-red-500]="hasFieldError('firstName')"
              [class.border-green-500]="formTree.isFieldValid('firstName')()"
              placeholder="Enter your first name"
            />
            <div
              *ngIf="hasFieldError('firstName')"
              class="mt-1 text-sm text-red-600"
            >
              {{ getFieldError('firstName') }}
            </div>
          </div>

          <div>
            <label
              for="lastName"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Last Name *
            </label>
            <input
              id="lastName"
              [(ngModel)]="formTree.state.lastName"
              (blur)="markFieldAsTouched('lastName')"
              name="lastName"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
              [class.border-red-500]="hasFieldError('lastName')"
              [class.border-green-500]="formTree.isFieldValid('lastName')()"
              placeholder="Enter your last name"
            />
            <div
              *ngIf="hasFieldError('lastName')"
              class="mt-1 text-sm text-red-600"
            >
              {{ getFieldError('lastName') }}
            </div>
          </div>

          <div>
            <label
              for="dateOfBirth"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Date of Birth *
            </label>
            <input
              id="dateOfBirth"
              type="date"
              [(ngModel)]="formTree.state.dateOfBirth"
              (blur)="markFieldAsTouched('dateOfBirth')"
              name="dateOfBirth"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
              [class.border-red-500]="hasFieldError('dateOfBirth')"
              [class.border-green-500]="formTree.isFieldValid('dateOfBirth')()"
            />
            <div
              *ngIf="hasFieldError('dateOfBirth')"
              class="mt-1 text-sm text-red-600"
            >
              {{ getFieldError('dateOfBirth') }}
            </div>
          </div>

          <div>
            <label
              for="phoneNumber"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Phone Number
            </label>
            <input
              id="phoneNumber"
              type="tel"
              [(ngModel)]="formTree.state.phoneNumber"
              (blur)="markFieldAsTouched('phoneNumber')"
              name="phoneNumber"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
              [class.border-red-500]="hasFieldError('phoneNumber')"
              [class.border-green-500]="formTree.isFieldValid('phoneNumber')()"
              placeholder="+1 (555) 123-4567"
            />
            <div
              *ngIf="hasFieldError('phoneNumber')"
              class="mt-1 text-sm text-red-600"
            >
              {{ getFieldError('phoneNumber') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Account Information -->
      <div class="border-b border-gray-200 pb-6">
        <h3 class="text-lg font-medium text-gray-800 mb-4">
          Account Information
        </h3>

        <div class="space-y-4">
          <div>
            <label
              for="username"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Username *
              <span
                *ngIf="isCheckingUsername"
                class="text-blue-600 text-xs ml-1"
              >
                (checking availability...)
              </span>
            </label>
            <input
              id="username"
              [(ngModel)]="formTree.state.username"
              (blur)="markFieldAsTouched('username')"
              (input)="onUsernameChange()"
              name="username"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
              [class.border-red-500]="
                hasFieldError('username') || hasAsyncFieldError('username')
              "
              [class.border-green-500]="
                formTree.isFieldValid('username')() &&
                !hasAsyncFieldError('username')
              "
              placeholder="Choose a unique username"
            />
            <div
              *ngIf="hasFieldError('username')"
              class="mt-1 text-sm text-red-600"
            >
              {{ getFieldError('username') }}
            </div>
            <div
              *ngIf="hasAsyncFieldError('username')"
              class="mt-1 text-sm text-red-600"
            >
              {{ getAsyncFieldError('username') }}
            </div>
          </div>

          <div>
            <label
              for="email"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Email Address *
              <span *ngIf="isCheckingEmail" class="text-blue-600 text-xs ml-1">
                (checking availability...)
              </span>
            </label>
            <input
              id="email"
              type="email"
              [(ngModel)]="formTree.state.email"
              (blur)="markFieldAsTouched('email')"
              (input)="onEmailChange()"
              name="email"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
              [class.border-red-500]="
                hasFieldError('email') || hasAsyncFieldError('email')
              "
              [class.border-green-500]="
                formTree.isFieldValid('email')() && !hasAsyncFieldError('email')
              "
              placeholder="your.email@example.com"
            />
            <div
              *ngIf="hasFieldError('email')"
              class="mt-1 text-sm text-red-600"
            >
              {{ getFieldError('email') }}
            </div>
            <div
              *ngIf="hasAsyncFieldError('email')"
              class="mt-1 text-sm text-red-600"
            >
              {{ getAsyncFieldError('email') }}
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label
                for="password"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                Password *
              </label>
              <input
                id="password"
                type="password"
                [(ngModel)]="formTree.state.password"
                (blur)="markFieldAsTouched('password')"
                (input)="onPasswordChange()"
                name="password"
                class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                [class.border-red-500]="hasFieldError('password')"
                [class.border-green-500]="formTree.isFieldValid('password')()"
                placeholder="Choose a strong password"
              />
              <div
                *ngIf="hasFieldError('password')"
                class="mt-1 text-sm text-red-600"
              >
                {{ getFieldError('password') }}
              </div>
              <div class="mt-1 text-xs text-gray-500">
                Must be at least 8 characters with uppercase, lowercase, and
                number
              </div>
            </div>

            <div>
              <label
                for="confirmPassword"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                Confirm Password *
              </label>
              <input
                id="confirmPassword"
                type="password"
                [(ngModel)]="formTree.state.confirmPassword"
                (blur)="markFieldAsTouched('confirmPassword')"
                (input)="onConfirmPasswordChange()"
                name="confirmPassword"
                class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                [class.border-red-500]="hasFieldError('confirmPassword')"
                [class.border-green-500]="
                  formTree.isFieldValid('confirmPassword')()
                "
                placeholder="Confirm your password"
              />
              <div
                *ngIf="hasFieldError('confirmPassword')"
                class="mt-1 text-sm text-red-600"
              >
                {{ getFieldError('confirmPassword') }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Terms and Conditions -->
      <div>
        <div class="flex items-start">
          <input
            type="checkbox"
            id="agreeToTerms"
            [(ngModel)]="formTree.state.agreeToTerms"
            (change)="markFieldAsTouched('agreeToTerms')"
            name="agreeToTerms"
            class="h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded mt-1"
          />
          <label for="agreeToTerms" class="ml-2 block text-sm text-gray-700">
            I agree to the
            <a href="#" class="text-orange-600 hover:text-orange-700"
              >Terms and Conditions</a
            >
            and
            <a href="#" class="text-orange-600 hover:text-orange-700"
              >Privacy Policy</a
            >
            *
          </label>
        </div>
        <div
          *ngIf="hasFieldError('agreeToTerms')"
          class="mt-1 text-sm text-red-600"
        >
          {{ getFieldError('agreeToTerms') }}
        </div>
      </div>

      <!-- Form Actions -->
      <div
        class="flex justify-between items-center pt-6 border-t border-gray-200"
      >
        <div class="flex space-x-3">
          <button
            type="button"
            (click)="validateForm()"
            class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
          >
            Validate Form
          </button>

          <button
            type="button"
            (click)="fillSampleData()"
            class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"
          >
            Fill Sample Data
          </button>

          <button
            type="button"
            (click)="resetForm()"
            class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors"
          >
            Reset Form
          </button>
        </div>

        <button
          type="submit"
          [disabled]="!formTree.valid() || formTree.submitting()"
          class="px-6 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:bg-gray-400 transition-colors"
        >
          {{ formTree.submitting() ? 'Registering...' : 'Register Account' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Validation Summary -->
  <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Current Errors -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        üö® Validation Errors
      </h2>

      <div *ngIf="getErrorCount() === 0" class="text-center py-8 text-gray-500">
        <div class="text-4xl mb-2">üéâ</div>
        <div>No validation errors!</div>
      </div>

      <div *ngIf="getErrorCount() > 0" class="space-y-3">
        <div
          *ngFor="let error of getAllErrors()"
          class="p-3 bg-red-50 border border-red-200 rounded-lg"
        >
          <div class="font-medium text-red-800">{{ error.field }}</div>
          <div class="text-sm text-red-600">{{ error.message }}</div>
        </div>
      </div>
    </div>

    <!-- Form State -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">üìä Form State</h2>

      <div class="space-y-4">
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="font-medium text-gray-800 mb-2">Current Values</h3>
          <pre
            class="text-xs bg-gray-800 text-green-400 p-3 rounded overflow-x-auto"
            >{{ getCurrentValues() | json }}</pre
          >
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="font-medium text-gray-800 mb-2">Touched Fields</h3>
          <div class="text-sm text-gray-600">
            {{ Object.keys(formTree.touched()).join(', ') || 'None' }}
          </div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="font-medium text-gray-800 mb-2">Form Statistics</h3>
          <div class="space-y-1 text-sm">
            <div>
              <strong>Valid:</strong> {{ formTree.valid() ? 'Yes' : 'No' }}
            </div>
            <div>
              <strong>Dirty:</strong> {{ formTree.dirty() ? 'Yes' : 'No' }}
            </div>
            <div>
              <strong>Submitting:</strong>
              {{ formTree.submitting() ? 'Yes' : 'No' }}
            </div>
            <div><strong>Error Count:</strong> {{ getErrorCount() }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Code Example -->
  <div class="mt-8 bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">üíª Form Tree Setup</h2>

    <div class="bg-gray-800 text-gray-300 p-4 rounded-lg overflow-x-auto">
      <pre><code>{{ formTreeCode }}</code></pre>
    </div>
  </div>
</div>
